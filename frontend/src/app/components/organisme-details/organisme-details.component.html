<div class="details">

  <!-- Header -->
  <div class="header">
    <div>
     <div class="name">
  {{ company?.name || ('Organisme #' + companyId) }}
  <span class="muted" *ngIf="company?.symbol">({{ company?.symbol }})</span>
</div>

      <div class="meta">
        Source: {{ snapshot?.source || 'â€”' }} Â·
        Fetched: {{ snapshot?.fetchedAt ? (snapshot?.fetchedAt | date:'medium') : 'â€”' }}
      </div>
    </div>

    

    <button (click)="refreshNow()" [disabled]="loading">
      {{ loading ? 'â€¦' : 'ðŸ”„ Refresh from ZOYA' }}
    </button>
  </div>

  <!-- Tableau colonnes (une seule ligne de valeurs) -->
  <div class="table-wrap" *ngIf="snapshot as s">
    <table class="rules-table">
      <thead>
        <tr>
          <th>Statut</th>
          <th>Purification (AAOIFI)</th>
          <th *ngIf="s.compliantRevenuePct !== undefined">Compliant revenue</th>
          <th>Interest debt</th>
          <th>Interest income</th>
          <th>Cash &amp; interest</th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <!-- Statut -->
          <td>
            <span class="badge"
                  [class.pass]="s.status === 'HALAL'"
                  [class.fail]="s.status === 'HARAM'">
              {{ s.status || 'UNKNOWN' }}
            </span>
          </td>

          <!-- Purification -->
          <td class="value">
            <strong>{{ pct(s.purificationRatio) }}</strong>
            <div class="bar"><span [style.width.%]="width(s.purificationRatio)"></span></div>
          </td>

          <!-- Compliant revenue (optionnel) -->
          <td *ngIf="s.compliantRevenuePct !== undefined" class="value">
            <strong>{{ pct(s.compliantRevenuePct) }}</strong>
            <div class="bar"><span [style.width.%]="width(s.compliantRevenuePct)"></span></div>
          </td>

          <!-- Interest debt -->
          <td class="value">
            <strong>{{ pct(s.interestDebtPct) }}</strong>
            <div class="bar"><span [style.width.%]="width(s.interestDebtPct)"></span></div>
          </td>

          <!-- Interest income -->
          <td class="value">
            <strong>{{ s.interestIncomePct == null ? 'N/A' : pct(s.interestIncomePct) }}</strong>
            <div class="bar"><span [style.width.%]="width(s.interestIncomePct)"></span></div>
          </td>

          <!-- Cash & interest -->
          <td class="value">
            <strong>{{ pct(s.cashAndInterestPct) }}</strong>
            <div class="bar"><span [style.width.%]="width(s.cashAndInterestPct)"></span></div>
          </td>
        </tr>

        <!-- Notes -->
       
      </tbody>
    </table>
  </div>

  <div *ngIf="!snapshot && !loading" class="note">Aucun snapshot disponible.</div>
</div>
